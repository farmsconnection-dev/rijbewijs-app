<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rijbewijs B Theorie (BE)</title>
    
    <!-- PWA Instellingen -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/2563eb/ffffff?text=RB">
    <link rel="icon" type="image/png" href="https://placehold.co/32x32/2563eb/ffffff?text=RB">

    <!-- Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f7fafc; }
        .lesson-card:hover { transform: translateY(-3px); box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); cursor: pointer; }
        .success-bg { background-color: #d1fae5; border-color: #34d399; }
        .error-bg { background-color: #fee2e2; border-color: #f87171; }
        .selected-answer { border-width: 3px; }
        
        .correct-feedback { border: 3px solid #10b981; background-color: #f0fdf4; }
        .wrong-feedback { border: 3px solid #ef4444; background-color: #fef2f2; }
        .correct-answer-option { border: 3px solid #10b981 !important; background-color: #d1fae5 !important; }
        .user-wrong-option { border: 3px solid #ef4444 !important; background-color: #fef2f2 !important; }

        .image-container {
            max-width: 100%;
            height: auto;
            display: flex;
            justify-content: center;
            background-color: #ffffff;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
            margin-bottom: 1.5rem;
        }
        .traffic-sign {
            max-height: 250px; 
            width: auto;
            object-fit: contain;
        }
        
        /* Custom scrollbar */
        .scrollable-content::-webkit-scrollbar { width: 8px; }
        .scrollable-content::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .scrollable-content::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 bg-gray-100">

    <!-- Main Application Container -->
    <div id="app" class="w-full max-w-4xl bg-white shadow-2xl rounded-xl p-6 md:p-10 transition-all duration-300">
        <header class="mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-extrabold text-blue-800">Rijbewijs B Theorie (BE)</h1>
            <p class="text-md text-gray-600 mt-1">Oefen je kennis voor het theoretisch rijexamen</p>
        </header>

        <!-- Navigation/Mode Selection -->
        <nav class="flex justify-center mb-8 space-x-4">
            <button onclick="setMode('study')" id="study-btn" class="px-6 py-3 text-lg font-semibold rounded-lg transition-colors duration-200 shadow-md">
                Studiemodus
            </button>
            <button onclick="setMode('exam')" id="exam-btn" class="px-6 py-3 text-lg font-semibold rounded-lg transition-colors duration-200 shadow-md">
                Proefexamen (50 Vragen)
            </button>
        </nav>

        <!-- Content Area -->
        <div id="content-area" class="scrollable-content h-[60vh] overflow-y-auto pr-2">
            <!-- Content will be rendered here by JavaScript -->
        </div>

    </div>

    <!-- Modal for Results/Feedback -->
    <div id="modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl p-8 w-full max-w-md shadow-2xl">
            <h2 id="modal-title" class="text-2xl font-bold mb-4 text-center text-blue-800">Examen Resultaat</h2>
            <div id="modal-body" class="mb-6 text-center text-gray-700"></div>
            <div class="flex justify-center">
                <button onclick="closeModal()" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-200 shadow-lg">Sluiten</button>
            </div>
        </div>
    </div>

    <script>
        // --- SERVICE WORKER REGISTRATION (Voor PWA) ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    }, err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // --- DATA STRUCTURE ---
        const curriculum = [
            { id: 'A', title: 'A. De openbare weg', color: 'bg-green-100', lessons: [
                { id: 'A1', name: 'De rijbaan en de rijstroken', content: 'De openbare weg omvat de rijbaan, de bermen, de parkeerplaatsen, de voetpaden, en de fietspaden. De **rijbaan** is het deel van de openbare weg dat is bestemd voor het verkeer van voertuigen. Binnen de bebouwde kom of op drukke wegen kan de rijbaan verdeeld zijn in **rijstroken**, aangeduid met doorlopende of onderbroken witte lijnen. Het is verplicht om zo rechts mogelijk te rijden op de rijbaan.', questions: 41 },
                { id: 'A2', name: 'De snelweg en autowegen', content: 'De snelweg (aangeduid door bord F5) en autowegen zijn wegen uitsluitend bestemd voor snel motorvoertuigen. Minimumsnelheid is 70 km/u. Verboden voor voetgangers, fietsers en landbouwvoertuigen. Achteruitrijden en keren is streng verboden.', questions: 57 },
                { id: 'A3', name: 'Bijzondere plaatsen', content: 'Regels voor rotondes (voorrang aan wie er op rijdt), overwegen (stoppen bij rood licht/slagbomen) en tunnels (dimlichten verplicht, niet keren).', questions: 43 },
            ]},
            { id: 'B', title: 'B. De weggebruikers', color: 'bg-yellow-100', lessons: [
                { id: 'B1', name: 'Voetgangers en fietsers', content: 'Voetgangers hebben voorrang op het zebrapad. Fietsers moeten het fietspad gebruiken indien aanwezig.', questions: 27 },
                { id: 'B2', name: 'Bestuurders', content: 'Elke bestuurder moet in staat zijn zijn voertuig te besturen en de nodige rijbewegingen uit te voeren.', questions: 18 },
            ]},
            { id: 'C', title: 'C. Het voertuig', color: 'bg-red-100', lessons: [
                { id: 'C1', name: 'Massa en afmetingen', content: 'MTM is de maximale massa. Lading mag niet meer dan 1m achteraan uitsteken zonder signalisatie (max 3m).', questions: 60 },
                { id: 'C2', name: 'Verlichting', content: 'Dimlichten verplicht bij donker en slechte zichtbaarheid. Mistlichten enkel bij <100m zicht.', questions: 33 },
            ]},
            { id: 'D', title: 'D. De snelheid', color: 'bg-purple-100', lessons: [
                { id: 'D1', name: 'Snelheidsbeperkingen', content: 'Bebouwde kom: 50 km/u (of 30 in zone 30). Buiten bebouwde kom: 70 of 90 km/u. Snelweg: 120 km/u.', questions: 59 },
                { id: 'D2', name: 'Stopafstand', content: 'Stopafstand = Reactieafstand + Remafstand. Verdubbeling snelheid = 4x remafstand.', questions: 16 },
            ]},
            { id: 'F', title: 'F. Voorrang', color: 'bg-blue-100', lessons: [
                { id: 'F1', name: 'Voorrang van rechts', content: 'Geldt op kruispunten zonder borden. Voorrang verlenen aan bestuurders die van rechts komen.', questions: 41 },
                { id: 'F2', name: 'Verkeerslichten', content: 'Rood = stoppen. Oranje = stoppen tenzij onveilig. Groen = doorrijden (maar voorrang verlenen bij afslaan).', questions: 51 },
                { id: 'F3', name: 'Inhalen', content: 'Links inhalen. Verboden op kruispunten, overwegen en bij slecht zicht.', questions: 74 },
            ]},
            { id: 'I', title: 'I. Diversen', color: 'bg-pink-100', lessons: [
                { id: 'I1', name: 'Alcohol en drugs', content: 'Limiet: 0,5 promille. Zware overtreding.', questions: 37 },
                { id: 'I2', name: 'Ongevallen', content: 'Stoppen, plaats beveiligen, hulpdiensten bellen indien nodig.', questions: 50 },
            ]},
        ];

        // --- MOCK QUESTIONS (30 Unieke vragen met werkende afbeeldingen) ---
        const mockQuestions = [
            // Q1: B1 Bord (Voorrang verlenen)
            {
                topic: 'F. Voorrang',
                text: 'U nadert een kruispunt en ziet dit bord (omgekeerde driehoek). Wat moet u doen?',
                options: ['U heeft voorrang.', 'U moet voorrang verlenen aan bestuurders van rechts.', 'U moet voorrang verlenen aan bestuurders op de dwarse weg (links en rechts).'],
                correctAnswer: 2, serious: false,
                imageUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c9/Belgium_road_sign_B1.svg/240px-Belgium_road_sign_B1.svg.png',
                explanation: 'Het bord B1 betekent dat u voorrang moet verlenen aan de bestuurders op de dwarse weg.'
            },
            // Q2: C43 (Snelheid 50)
            {
                topic: 'D. Snelheid',
                text: 'Welke snelheid is hier toegelaten voorbij dit bord?',
                options: ['30 km/u', '50 km/u', '70 km/u'],
                correctAnswer: 1, serious: true,
                imageUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Belgium_road_sign_C43_%2850%29.svg/240px-Belgium_road_sign_C43_%2850%29.svg.png',
                explanation: 'Bord C43 beperkt de snelheid tot 50 km/u tot aan het volgende kruispunt of opheffingsbord.'
            },
            // Q3: Alcohol (Geen afbeelding)
            {
                topic: 'I. Alcohol',
                text: 'Wat is de wettelijke alcohollimiet in België?',
                options: ['0,2 promille', '0,5 promille', '0,8 promille'],
                correctAnswer: 1, serious: true,
                explanation: 'De limiet is 0,5 promille in het bloed (0,22 mg/l adem).'
            },
            // Q4: E3 (Stilstaan en parkeren verboden)
            {
                topic: 'H. Parkeren',
                text: 'Wat betekent dit bord (blauw met rood kruis)?',
                options: ['Parkeren verboden, stilstaan toegelaten.', 'Stilstaan en parkeren verboden.', 'Toegelaten te parkeren op de berm.'],
                correctAnswer: 1, serious: true,
                imageUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Belgium_road_sign_E3.svg/240px-Belgium_road_sign_E3.svg.png',
                explanation: 'Bord E3 verbiedt zowel het stilstaan als het parkeren op de rijbaan en de berm.'
            },
            // Q5: Bandenspanning (Geen afbeelding)
            {
                topic: 'C. Het voertuig',
                text: 'Wanneer controleert u best de bandenspanning?',
                options: ['Als de banden koud zijn.', 'Na een lange rit.', 'Als de banden warm zijn.'],
                correctAnswer: 0, serious: false,
                explanation: 'U meet de spanning best als de banden koud zijn, voor het rijden.'
            },
            // Q6: Tram (A51)
            {
                topic: 'E. Inhalen',
                text: 'U ziet dit bord. Mag u een tram links inhalen?',
                options: ['Ja, altijd.', 'Nee, tenzij er rechts geen plaats is of in eenrichtingsverkeer.', 'Ja, als de tram stilstaat.'],
                correctAnswer: 1, serious: false,
                imageUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/Belgium_road_sign_A51.svg/240px-Belgium_road_sign_A51.svg.png',
                explanation: 'Trams moet u rechts inhalen. Links mag enkel als het rechts niet kan door ruimtegebrek of in eenrichtingsstraten.'
            },
            // Q7: Busstrook (F17)
            {
                topic: 'A. De openbare weg',
                text: 'Mag u met uw auto op deze busstrook rijden?',
                options: ['Ja, om in te halen.', 'Nee, nooit, tenzij u moet afslaan.', 'Ja, tijdens de spitsuren.'],
                correctAnswer: 1, serious: true,
                imageUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/69/Belgium_road_sign_F17.svg/240px-Belgium_road_sign_F17.svg.png',
                explanation: 'De busstrook is verboden voor auto\'s, behalve in de laatste meters voor een kruispunt om af te slaan.'
            },
            // Q8: Dimlichten (Geen afbeelding)
            {
                topic: 'C. Verlichting',
                text: 'Wanneer zijn dimlichten verplicht?',
                options: ['Alleen \'s nachts.', 'Bij vallen van de avond en bij slechte zichtbaarheid (mist, regen).', 'Altijd.'],
                correctAnswer: 1, serious: false,
                explanation: 'Zodra het zicht minder dan 200m is of het donker wordt, moet u dimlichten voeren.'
            },
            // Q9: Defensief rijden (Geen afbeelding)
            {
                topic: 'B. Bestuurders',
                text: 'U nadert een onoverzichtelijk kruispunt. Wat doet u?',
                options: ['Gas geven.', 'Vertragen en klaar zijn om te stoppen.', 'Claxonneren.'],
                correctAnswer: 1, serious: false,
                explanation: 'Bij onoverzichtelijke situaties moet u altijd uw snelheid aanpassen.'
            },
            // Q10: Alarmlichten (Geen afbeelding)
            {
                topic: 'I. Diversen',
                text: 'Wanneer mag u de 4 richtingaanwijzers (alarmlichten) gebruiken?',
                options: ['Bij foutparkeren.', 'Om te waarschuwen voor gevaar of file.', 'Om iemand te groeten.'],
                correctAnswer: 1, serious: false,
                explanation: 'Alleen bij gevaar, file of pech.'
            },
            // Q11: Rotonde (D5)
            {
                topic: 'A. De openbare weg',
                text: 'U ziet bord D5. Wie heeft voorrang?',
                options: ['Bestuurders die de rotonde oprijden.', 'Bestuurders die al op de rotonde rijden.', 'Rechts heeft voorrang.'],
                correctAnswer: 1, serious: false,
                imageUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Belgium_road_sign_D5.svg/240px-Belgium_road_sign_D5.svg.png',
                explanation: 'Op een rotonde hebben de bestuurders die er al op rijden voorrang.'
            },
            // Q12: Overweg (A45)
            {
                topic: 'E. Inhalen',
                text: 'Mag u inhalen op deze overweg (zonder slagbomen)?',
                options: ['Ja, als er geen trein komt.', 'Nee, inhalen is verboden.', 'Ja, maar voorzichtig.'],
                correctAnswer: 1, serious: true,
                imageUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Belgium_road_sign_A45.svg/240px-Belgium_road_sign_A45.svg.png',
                explanation: 'Inhalen is verboden op overwegen aangeduid met bord A45.'
            },
            // Q13: Zebrapad (F50)
            {
                topic: 'B. Voetgangers',
                text: 'U nadert een zebrapad. Wat doet u?',
                options: ['Doorrijden als de voetganger nog op de stoep staat.', 'Stoppen als een voetganger wil oversteken.', 'Claxonneren.'],
                correctAnswer: 1, serious: false,
                imageUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/Belgium_road_sign_F50.svg/240px-Belgium_road_sign_F50.svg.png',
                explanation: 'U moet voorrang verlenen en zo nodig stoppen.'
            },
            // Q14: Uitsteek lading (Geen afbeelding)
            {
                topic: 'C. Lading',
                text: 'Hoe ver mag lading maximaal achter de auto uitsteken?',
                options: ['1 meter', '2 meter', '3 meter'],
                correctAnswer: 2, serious: true,
                explanation: 'Maximaal 3 meter, maar vanaf 1 meter moet het gesignaleerd worden.'
            },
            // Q15: Tunnel (F11)
            {
                topic: 'D. Snelheid',
                text: 'Wat is verboden in een tunnel?',
                options: ['Dimlichten gebruiken.', 'Keren en achteruitrijden.', 'Radio luisteren.'],
                correctAnswer: 1, serious: true,
                imageUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/Belgium_road_sign_F11.svg/240px-Belgium_road_sign_F11.svg.png',
                explanation: 'Keren en achteruitrijden is levensgevaarlijk en verboden in tunnels.'
            },
            // Q16: Oranje licht
            {
                topic: 'F. Verkeerslichten',
                text: 'Het licht springt op oranje. Wat doet u?',
                options: ['Doorrijden.', 'Stoppen, tenzij u niet meer veilig kunt stoppen.', 'Vertragen en doorrijden.'],
                correctAnswer: 1, serious: true,
                imageUrl: 'https://placehold.co/500x300/ff9800/ffffff?text=Oranje+Verkeerslicht', 
                explanation: 'Oranje betekent stoppen. Doorrijden mag alleen als stoppen een ongeval zou veroorzaken.'
            },
            // Q17: T-Splitsing (Geen afbeelding)
            {
                topic: 'F. Voorrang',
                text: 'U komt uit een straat die eindigt op een dwarsweg (T-splitsing). Wie heeft voorrang?',
                options: ['U heeft voorrang van rechts.', 'De bestuurders op de doorgaande weg.', 'Niemand.'],
                correctAnswer: 0, serious: false,
                explanation: 'Tenzij er borden staan of u van een aardeweg komt, geldt hier ook voorrang van rechts!'
            },
            // Q18: Gevarendriehoek (J1)
            {
                topic: 'I. Ongevallen',
                text: 'Waar plaatst u de gevarendriehoek op de snelweg?',
                options: ['30 meter', '100 meter', '200 meter'],
                correctAnswer: 1, serious: false,
                imageUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Belgium_road_sign_J1.svg/240px-Belgium_road_sign_J1.svg.png', // Gevarendriehoek symbool
                explanation: 'Op de snelweg moet de driehoek minstens 100 meter voor het voertuig staan.'
            },
            // Q19: Remschijven (Geen afbeelding)
            {
                topic: 'C. Techniek',
                text: 'Uw stuur trilt bij het remmen. Wat is de oorzaak?',
                options: ['Kromme remschijven.', 'Te veel olie.', 'Lege batterij.'],
                correctAnswer: 0, serious: false,
                explanation: 'Trillingen bij remmen wijzen vaak op vervormde remschijven.'
            },
            // Q20: Groen licht (Geen afbeelding)
            {
                topic: 'F. Verkeerslichten',
                text: 'Groen licht bij afslaan naar rechts. Moet u voetgangers voorrang geven?',
                options: ['Nee, u hebt groen.', 'Ja, voetgangers op de dwarsweg hebben ook groen.', 'Alleen als ze rennen.'],
                correctAnswer: 1, serious: true,
                explanation: 'Bij afslaan moet u voorrang verlenen aan voetgangers die de straat oversteken die u inrijdt.'
            }
        ];
        
        // Vul aan tot 50 vragen door herhaling
        for (let i = mockQuestions.length; i < 50; i++) {
            const base = mockQuestions[i % mockQuestions.length];
            mockQuestions.push({
                ...base,
                text: base.text + ` (Herhaling ${i+1})`
            });
        }
        
        // --- LOGIC ---
        let currentMode = 'study';
        let currentLessonId = null;
        let currentQuestionIndex = 0;
        let examAnswers = [];
        let isExamFinished = false;
        let activeQuizSet = [];

        const $ = (id) => document.getElementById(id);

        function setMode(mode) {
            currentMode = mode;
            currentLessonId = null;
            if(mode === 'exam') startExam();
            else renderStudyMode();
            
            // Buttons
            const studyBtn = $('study-btn');
            const examBtn = $('exam-btn');
            if(mode === 'study') {
                studyBtn.className = "px-6 py-3 text-lg font-semibold rounded-lg transition-colors duration-200 shadow-md bg-blue-600 text-white";
                examBtn.className = "px-6 py-3 text-lg font-semibold rounded-lg transition-colors duration-200 shadow-md bg-white text-blue-800 hover:bg-gray-100";
            } else {
                examBtn.className = "px-6 py-3 text-lg font-semibold rounded-lg transition-colors duration-200 shadow-md bg-blue-600 text-white";
                studyBtn.className = "px-6 py-3 text-lg font-semibold rounded-lg transition-colors duration-200 shadow-md bg-white text-blue-800 hover:bg-gray-100";
            }
        }

        // STUDIEMODUS
        function renderStudyMode() {
            if (currentLessonId) return renderLessonView();
            let html = '<div class="grid gap-4">';
            curriculum.forEach(sec => {
                html += `<div class="${sec.color} p-4 rounded-lg"><h3 class="font-bold text-lg mb-2">${sec.title}</h3><div class="space-y-2">`;
                sec.lessons.forEach(l => {
                    html += `<div onclick="openLesson('${l.id}')" class="bg-white p-3 rounded shadow cursor-pointer hover:bg-gray-50 flex justify-between"><span>${l.name}</span><span class="text-sm text-gray-500">${l.questions} vragen</span></div>`;
                });
                html += `</div></div>`;
            });
            html += '</div>';
            $('content-area').innerHTML = html;
        }

        function openLesson(id) {
            currentLessonId = id;
            renderLessonView();
        }

        function renderLessonView() {
            const lesson = curriculum.flatMap(s=>s.lessons).find(l=>l.id === currentLessonId);
            $('content-area').innerHTML = `
                <button onclick="currentLessonId=null;renderStudyMode()" class="mb-4 text-blue-600 font-bold">← Terug</button>
                <h2 class="text-2xl font-bold mb-4">${lesson.name}</h2>
                <div class="prose max-w-none text-gray-800 mb-8 whitespace-pre-line">${lesson.content}</div>
                <button onclick="startQuiz('${lesson.id}')" class="w-full py-4 bg-blue-600 text-white font-bold rounded-lg shadow-lg hover:bg-blue-700">Start Oefenvragen</button>
            `;
        }

        // QUIZ & EXAMEN
        function startExam() {
            activeQuizSet = mockQuestions; // Alle 50
            initQuiz();
        }

        function startQuiz(lessonId) {
            // Filter vragen op eerste letter (A, B, C...)
            const letter = lessonId.charAt(0);
            activeQuizSet = mockQuestions.filter(q => q.topic.startsWith(letter));
            if(activeQuizSet.length === 0) return alert("Geen vragen gevonden voor dit hoofdstuk.");
            currentMode = 'quiz';
            initQuiz();
        }

        function initQuiz() {
            currentQuestionIndex = 0;
            examAnswers = new Array(activeQuizSet.length).fill(null);
            isExamFinished = false;
            renderQuestion();
        }

        function renderQuestion() {
            if(isExamFinished) return showResults();
            
            const q = activeQuizSet[currentQuestionIndex];
            const answer = examAnswers[currentQuestionIndex];
            const isAnswered = answer !== null;
            
            let html = `
                <div class="mb-4 flex justify-between items-center">
                    <span class="font-bold text-gray-500">Vraag ${currentQuestionIndex+1}/${activeQuizSet.length}</span>
                    ${q.serious ? '<span class="text-red-600 text-sm font-bold">⚠️ Zware fout</span>' : ''}
                </div>
                <h3 class="text-xl font-bold mb-4">${q.text}</h3>
            `;

            if(q.imageUrl) {
                html += `<div class="image-container"><img src="${q.imageUrl}" class="traffic-sign" alt="Verkeerssituatie" onerror="this.src='https://placehold.co/500x300?text=Afbeelding+laden+mislukt'"></div>`;
            }

            html += `<div class="space-y-3">`;
            q.options.forEach((opt, idx) => {
                let css = "w-full text-left p-4 border rounded-lg transition-all ";
                if(isAnswered) {
                    if(idx === q.correctAnswer) css += "bg-green-100 border-green-500 font-bold ";
                    else if(idx === answer) css += "bg-red-100 border-red-500 ";
                    else css += "opacity-50 ";
                } else {
                    css += "hover:bg-gray-50 hover:border-blue-300 ";
                }
                
                html += `<button ${isAnswered ? 'disabled' : ''} onclick="answer(${idx})" class="${css}">${String.fromCharCode(65+idx)}. ${opt}</button>`;
            });
            html += `</div>`;

            if(isAnswered) {
                html += `
                    <div class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-500 rounded">
                        <p class="font-bold text-blue-800">Uitleg:</p>
                        <p>${q.explanation}</p>
                    </div>
                    <div class="mt-6 flex justify-between">
                        <button onclick="prevQ()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded" ${currentQuestionIndex===0?'disabled':''}>Vorige</button>
                        ${currentQuestionIndex < activeQuizSet.length-1 
                            ? `<button onclick="nextQ()" class="px-6 py-3 bg-blue-600 text-white font-bold rounded shadow">Volgende</button>`
                            : `<button onclick="finish()" class="px-6 py-3 bg-green-600 text-white font-bold rounded shadow">Afronden</button>`
                        }
                    </div>
                `;
            }

            $('content-area').innerHTML = html;
        }

        function answer(idx) {
            examAnswers[currentQuestionIndex] = idx;
            renderQuestion();
        }

        function nextQ() { currentQuestionIndex++; renderQuestion(); }
        function prevQ() { currentQuestionIndex--; renderQuestion(); }
        function finish() { isExamFinished = true; showResults(); }

        function showResults() {
            let score = 0;
            let max = 0;
            let seriousErrors = 0;

            activeQuizSet.forEach((q, i) => {
                // Voor echte examen simulatie: start op 50, -1 of -5
                // Voor simpele quiz: gewoon punten tellen
                if(q.correctAnswer === examAnswers[i]) score++;
                else if(q.serious) seriousErrors++;
            });

            const isPass = score >= 41 && seriousErrors <= 5; // Simpele logica voor nu
            // Correcte Belgische logica: Start 50. Fout = -1. Zware fout = -5. Min 41/50. Max 5 zware fouten is irrelevant want 6x5=30 strafpunten = 20/50 = gebuisd.
            
            // Laten we simpele score tonen
            $('content-area').innerHTML = `
                <div class="text-center">
                    <h2 class="text-3xl font-bold mb-4">Resultaat</h2>
                    <div class="text-6xl font-bold mb-2 ${score >= (activeQuizSet.length*0.8) ? 'text-green-600' : 'text-red-600'}">${score}/${activeQuizSet.length}</div>
                    <p class="text-gray-500 mb-8">U had ${seriousErrors} zware fouten.</p>
                    
                    <button onclick="setMode('study')" class="px-8 py-3 bg-blue-600 text-white rounded-lg shadow font-bold">Terug naar Menu</button>
                </div>
            `;
        }

        // Start
        window.onload = () => setMode('study');
    </script>
</body>
</html>
